version: '3.8'

services:
  gisgate:
    build: .
    container_name: gisgate-app
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - HOSTNAME=0.0.0.0
      # Don't set HTTPS_ENABLED=true until you have proper SSL setup
      # - HTTPS_ENABLED=false  # Optional: explicitly set to false for HTTP testing
    volumes:
      # Mount .env file from host (secure approach)
      - ./.env:/app/.env:ro
    restart: unless-stopped
    networks:
      - gisgate-network

  # Optional: Nginx reverse proxy (if you want SSL/domain setup)
  nginx:
    image: nginx:alpine
    container_name: gisgate-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - gisgate
    restart: unless-stopped
    networks:
      - gisgate-network

networks:
  gisgate-network:
    driver: bridge

# Note: PostgreSQL and MinIO are external (on VPS level)
# Database: External PostgreSQL on VPS
# Storage: External MinIO on VPS
# No volumes needed since everything is external