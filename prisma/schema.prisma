generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Article {
  id              String         @id @default(uuid())
  title           String
  slug            String         @unique
  excerpt         String?
  content         String
  featuredImage   String?
  status          ArticleStatus  @default(DRAFT)
  publishedAt     DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  metaTitle       String?
  metaDescription String?
  aiGenerated     Boolean        @default(false)
  aiPrompt        String?
  viewCount       Int            @default(0)
  category        String?
  tags            String?
  authorSlug      String?
  authorId        String?
  authorName      String?
  images          ArticleImage[]
  author          User?          @relation("UserArticles", fields: [authorId], references: [id])

  @@map("articles")
}

model Video {
  id              String           @id @default(uuid())
  title           String
  slug            String           @unique
  excerpt         String?
  content         String
  videoUrl        String?
  duration        String?
  thumbnail       String?
  featuredImage   String?
  status          ArticleStatus    @default(DRAFT)
  publishedAt     DateTime?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  metaTitle       String?
  metaDescription String?
  aiGenerated     Boolean          @default(false)
  aiPrompt        String?
  viewCount       Int              @default(0)
  category        String?
  tags            String?
  authorId        String?
  authorName      String?
  authorSlug      String?
  courseId        String?
  order           Int              @default(0)
  progress        LessonProgress[]
  images          VideoImage[]
  author          User?            @relation("UserVideos", fields: [authorId], references: [id])
  course          Course?          @relation("CourseLessons", fields: [courseId], references: [id])

  @@map("videos")
}

model ArticleImage {
  id        String  @id @default(uuid())
  url       String
  alt       String?
  caption   String?
  articleId String
  article   Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@map("article_images")
}

model VideoImage {
  id      String  @id @default(uuid())
  url     String
  alt     String?
  caption String?
  videoId String
  video   Video   @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@map("video_images")
}

model User {
  id                       String             @id @default(uuid())
  email                    String             @unique
  username                 String?            @unique
  password                 String
  firstName                String?
  lastName                 String?
  avatar                   String?
  bio                      String?
  website                  String?
  emailVerified            Boolean            @default(false)
  emailVerificationToken   String?            @unique
  emailVerificationExpires DateTime?
  passwordResetToken       String?            @unique
  passwordResetExpires     DateTime?
  isActive                 Boolean            @default(true)
  lastLogin                DateTime?
  loginAttempts            Int                @default(0)
  lockUntil                DateTime?
  role                     UserRole           @default(USER)
  wordpressId              Int?               @unique
  wordpressMeta            String?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @updatedAt
  fullNameArabic           String?
  fullNameEnglish          String?
  articles                 Article[]          @relation("UserArticles")
  certificates             Certificate[]      @relation("UserCertificates")
  enrollments              CourseEnrollment[] @relation("UserEnrollments")
  courses                  Course[]           @relation("UserCourses")
  progress                 LessonProgress[]   @relation("UserProgress")
  payments                 PaymentOrder[]     @relation("UserPayments")
  solutionDownloads        SolutionDownload[] @relation("UserDownloads")
  solutionPurchases        SolutionPurchase[] @relation("UserPurchases")
  solutionReviews          SolutionReview[]   @relation("UserReviews")
  solutions                Solution[]         @relation("UserSolutions")
  sessions                 UserSession[]
  videos                   Video[]            @relation("UserVideos")

  @@map("users")
}

model UserSession {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_sessions")
}

model Course {
  id                String             @id @default(uuid())
  title             String
  slug              String             @unique
  description       String?
  excerpt           String?
  featuredImage     String?
  category          String?
  tags              String?
  status            ArticleStatus      @default(DRAFT)
  publishedAt       DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  price             Float?             @default(0)
  currency          String?            @default("USD")
  isFree            Boolean            @default(true)
  isPrivate         Boolean            @default(false)
  authorId          String?
  authorName        String?
  totalLessons      Int                @default(0)
  level             CourseLevel        @default(BEGINNER)
  language          String?            @default("ar")
  titleEnglish      String?
  authorNameEnglish String?
  durationUnit      String?
  durationValue     Int?
  enrollments       CourseEnrollment[]
  author            User?              @relation("UserCourses", fields: [authorId], references: [id])
  paymentOrders     PaymentOrder[]
  lessons           Video[]            @relation("CourseLessons")

  @@map("courses")
}

model CourseEnrollment {
  id             String           @id @default(uuid())
  userId         String
  courseId       String
  enrolledAt     DateTime         @default(now())
  completedAt    DateTime?
  progress       Float            @default(0)
  isCompleted    Boolean          @default(false)
  certificates   Certificate[]
  course         Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user           User             @relation("UserEnrollments", fields: [userId], references: [id], onDelete: Cascade)
  lessonProgress LessonProgress[]

  @@unique([userId, courseId])
  @@map("course_enrollments")
}

model LessonProgress {
  id            String           @id @default(uuid())
  userId        String
  lessonId      String
  enrollmentId  String
  watchedTime   Int              @default(0)
  isCompleted   Boolean          @default(false)
  completedAt   DateTime?
  lastWatchedAt DateTime         @default(now())
  enrollment    CourseEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  lesson        Video            @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  user          User             @relation("UserProgress", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
  @@map("lesson_progress")
}

model CertificateTemplate {
  id               String        @id @default(uuid())
  name             String
  language         String
  backgroundImage  String
  fields           Json
  isActive         Boolean       @default(true)
  isDefault        Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  backgroundHeight Int           @default(3508)
  backgroundWidth  Int           @default(2480)
  arCertificates   Certificate[] @relation("ArCertificateTemplate")
  enCertificates   Certificate[] @relation("EnCertificateTemplate")

  @@map("certificate_templates")
}

model Certificate {
  id            String               @id @default(uuid())
  userId        String
  enrollmentId  String
  certificateId String               @unique
  data          Json
  createdAt     DateTime             @default(now())
  arTemplateId  String?
  enTemplateId  String?
  arTemplate    CertificateTemplate? @relation("ArCertificateTemplate", fields: [arTemplateId], references: [id])
  enTemplate    CertificateTemplate? @relation("EnCertificateTemplate", fields: [enTemplateId], references: [id])
  enrollment    CourseEnrollment     @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  user          User                 @relation("UserCertificates", fields: [userId], references: [id])

  @@unique([userId, enrollmentId])
  @@map("certificates")
}

model PaymentOrder {
  id              String               @id @default(uuid())
  userId          String
  courseId        String
  amount          Float
  currency        String               @default("USD")
  status          PaymentStatus        @default(PENDING)
  paypalOrderId   String?
  paypalPaymentId String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  paidAt          DateTime?
  course          Course               @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user            User                 @relation("UserPayments", fields: [userId], references: [id], onDelete: Cascade)
  refunds         PaymentRefund[]
  transactions    PaymentTransaction[]

  @@map("payment_orders")
}

model PaymentTransaction {
  id                  String        @id @default(uuid())
  orderId             String
  paypalTransactionId String        @unique
  amount              Float
  currency            String        @default("USD")
  status              PaymentStatus @default(PENDING)
  paypalFee           Float?
  netAmount           Float?
  createdAt           DateTime      @default(now())
  order               PaymentOrder  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payment_transactions")
}

model PaymentRefund {
  id             String       @id @default(uuid())
  orderId        String
  paypalRefundId String       @unique
  amount         Float
  currency       String       @default("USD")
  reason         String?
  status         RefundStatus @default(PENDING)
  requestedAt    DateTime     @default(now())
  processedAt    DateTime?
  order          PaymentOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payment_refunds")
}

model Solution {
  id               String             @id @default(uuid())
  title            String
  slug             String             @unique
  description      String
  excerpt          String?
  featuredImage    String?
  images           String?
  solutionType     SolutionType
  category         String?
  tags             String?
  price            Float?             @default(0)
  currency         String?            @default("USD")
  isFree           Boolean            @default(true)
  fileUrl          String?
  fileSize         String?
  fileType         String?
  demoUrl          String?
  documentationUrl String?
  sourceCodeUrl    String?
  version          String?
  lastUpdated      DateTime?
  compatibility    String?
  requirements     String?
  status           ArticleStatus      @default(DRAFT)
  publishedAt      DateTime?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  authorId         String?
  authorName       String?
  sellerInfo       String?
  viewCount        Int                @default(0)
  downloadCount    Int                @default(0)
  purchaseCount    Int                @default(0)
  rating           Float?             @default(0)
  reviewCount      Int                @default(0)
  metaTitle        String?
  metaDescription  String?
  downloads        SolutionDownload[]
  purchases        SolutionPurchase[]
  reviews          SolutionReview[]
  author           User?              @relation("UserSolutions", fields: [authorId], references: [id])

  @@map("solutions")
}

model SolutionReview {
  id         String   @id @default(uuid())
  solutionId String
  userId     String
  rating     Int
  comment    String?
  isVerified Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  solution   Solution @relation(fields: [solutionId], references: [id], onDelete: Cascade)
  user       User     @relation("UserReviews", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, solutionId])
  @@map("solution_reviews")
}

model SolutionPurchase {
  id            String        @id @default(uuid())
  userId        String
  solutionId    String
  amount        Float
  currency      String        @default("USD")
  status        PaymentStatus @default(PENDING)
  paypalOrderId String?
  purchasedAt   DateTime      @default(now())
  solution      Solution      @relation(fields: [solutionId], references: [id], onDelete: Cascade)
  user          User          @relation("UserPurchases", fields: [userId], references: [id], onDelete: Cascade)

  @@map("solution_purchases")
}

model SolutionDownload {
  id           String   @id @default(uuid())
  userId       String?
  solutionId   String
  downloadedAt DateTime @default(now())
  ipAddress    String?
  solution     Solution @relation(fields: [solutionId], references: [id], onDelete: Cascade)
  user         User?    @relation("UserDownloads", fields: [userId], references: [id], onDelete: Cascade)

  @@map("solution_downloads")
}

model NewsletterSubscriber {
  id             String    @id @default(uuid())
  email          String    @unique
  firstName      String?
  lastName       String?
  subscribedAt   DateTime  @default(now())
  isActive       Boolean   @default(true)
  unsubscribedAt DateTime?
  source         String?

  @@map("newsletter_subscribers")
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum UserRole {
  ADMIN
  EDITOR
  AUTHOR
  USER
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum RefundStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum SolutionType {
  TOOL
  ADDIN
  PLUGIN
  SCRIPT
  DATASET
  TEMPLATE
  TOOLBOX
  MODEL
  STYLE
  WIDGET
  APPLICATION
  SERVICE
  EXTENSION
  LIBRARY
  CONFIGURATION
  OTHER
}
